# 用户需求说明及领域模型

[TOC]

## 一、背景调研

## 二、用户需求

## 三、计费系统

### 1、计费逻辑

<div align=center>
<img src="https://i.loli.net/2021/04/09/87eRHbnDBPfy6ht.png" width = "400" height = "330"/>
</div>



客户在更改空调状态之后空调向服务器发送状态变化的相关信息，服务器随后根据收到的信息修改其存储的空调状态相关信息，并更新金额，同时将必要历史信息写入数据库。除此以外，服务器周期性地或者在必要时向空调发送当前运行周期内的计费量供空调显示给客户。

### 2、服务器计费逻辑

<div align=center>
<img src="https://i.loli.net/2021/04/09/BezQcNquKTt5rFa.png" width = 60% height = 60%/>
</div>

服务器周期性的向空调发送金额信息以供显示，并在每个周期发送前和收到空调状态变化信息时更新存储的计费金额。

### 3、金额计算

#### 性能标准

* **温控范围**：16度-30度
* **风速限制**：1 ~ 3 档
* **缺省温度/启动温度**：23度

#### 计算详细

* **基础费用**：1元/度

* **电量花费**：
* 1档风 0.01度/分
    * 2档风 0.02度/分
    * 3档风 0.03度/分
    * 开机 0.5度

## 四、业务介绍及业务流程

### 1、业务介绍

​		主要有**顾客业务**、**管理员业务**、**前台业务**。顾客业务有开关空凋、调节空调风速与温度、查看当前空调消费的金额以及刷卡进房。前台业务有入住办理与退房办理。管理员业务有生成报表、查看流水控制所有空调总开关与设置优惠力度。

### 2、业务流程

#### 前台业务流程

​	顾客办理**入住手续**，前台将顾客手机号发给服务器，服务器查询本地的缓存或数据库将预留的姓名、房间号以及密码返回给前台，前台将房间号与密码告诉顾客并将房卡给顾客。

​	顾客办理**退房手续**，前台将顾客退还的房卡的房间号发给服务器，服务器修改本地缓存或数据库，并将空凋的使用时间及消费金额返回给前台，前台收取相应费用，并添加流水记录。

#### 顾客业务流程

​	办理完入住手续后，找到相应的房间**刷卡进房**，此过程将房间号与密码传给服务器，服务器查询本地的缓存或数据库返回顾客姓名，并生成token。

​	顾客进房后可以**开关空调**、**调节风速和温度**，将房间号与空调开关状态或目标温度或目标风速发送给服务器，并在header里设置token，服务器验证token并修改空凋的相关状态。

​	顾客在入住期间可以**查看自己消费的金额**，将房间号发给服务器，服务器便通过一系列查询数据并计算得出结果后返回费用，并将此刻空调开关状态一起返回。

#### 管理员业务流程

​	管理员需要手动**登录**系统，将用户名与密码发送给服务器，服务器返回管理员姓名，并生成token一起返回。

​	登录过后管理员可以：

​		**生成报表**，将当前时间发送给服务器，服务器返回一个列表，列表每个元素包括房间号、空调开关状态、当前温度、当前风速与此房间优惠力度。

​		**查看流水**，将需要查看的日期发送给服务器，服务器查询后返回列表，列表中每个元素包括房间名、退房时间与金额。

​		**控制所有空调总开关**，无需带任何参数信息，发送给服务器后服务器修改相关信息。

​		**设置单个房间的优惠力度**，将房间号与优惠力度发送送给服务器，服务器修改对应房间的优惠力度。

## 五、用户需求说明书(P72)

![image-20210409221702619](https://i.loli.net/2021/04/09/MwtrEnZPgVQ3UCo.png)

## 六、领域模型

